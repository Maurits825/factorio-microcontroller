// compute the nth Fibonacci number, starting at 1
VAR n
MOVLW 10
MOVWF n

MOVFW n
MOVWF 2 //to get n in our function scope
CALL fibonacci n

FN fibonacci
VAR n
// if (n <= 1), n < 2, F < W, W > F
MOVLW 2
GRTWF,0 n
RETFW n

// return fib(n-1) + fib(n-2);
VAR n_minus_1
MOVFW n
MOVWF n_minus_1
DECRF n_minus_1

VAR n_minus_2
MOVWF n_minus_2
DECRF n_minus_2
DECRF n_minus_2

//load input arg
MOVFW n_minus_1
MOVWF 4
CALL fibonacci n_minus_1
VAR ret_1
MOVWF ret_1

//load input arg
MOVFW n_minus_2
MOVWF 5
CALL fibonacci n_minus_2
VAR ret_2
MOVWF ret_2

MOVFW ret_1
ADDWF,f ret_2
WOUTF,2 ret_2
RETFW ret_2
END